{% extends 'price_scrape/basePS.html.twig' %}

{% block title %}Price Scrape Tool{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="card mb-3">
        <div class="card-header">
          <i class="fa fa-area-chart"></i> Price history</div>
        <div class="card-body">
        <div class="row">
            <div id="chartTitle" class="col-xs-12 col-md-9">
                TITLE
            </div>
            <div class="col-md-3 mb-4">
                Device<br>
                <select id="select" onchange="getChart(this)">
                    <option value="0">Select a device</option>
                {% for item in items %}
                    <option value="{{ item.id }}">{{ item.device }}</option>
                {% endfor %}
                </select>
            </div>
            </div>
            <div class="row">
            <div id="chart" class="col-xs-6 col-md-9">
                CHART
            </div>
            <div class="col-xs-6 col-md-3">
                <p class="h2">Info</p>
                <p>The webs that will be scanned looking for that device are:</p>
                <div class="list-group">
                    <a href="https://www.carphonewarehouse.com" target="_blank" class="list-group-item list-group-item-action">Carphone Warehouse</a>
                    <a href="https://www.musicmagpie.co.uk" target="_blank" class="list-group-item list-group-item-action">MusicMagpie</a>
                    <a href="https://www.mazumamobile.com" target="_blank" class="list-group-item list-group-item-action">Mazuma Mobile</a>
                    <a href="https://ee.co.uk" target="_blank" class="list-group-item list-group-item-action">EE</a>
                    <a href="https://www.vodafone.co.uk" target="_blank" class="list-group-item list-group-item-action">Vodafone</a>
                    <a href="https://www.mobilephonexchange.co.uk" target="_blank" class="list-group-item list-group-item-action">Movile Phone Xchange</a>
                </div>
            </div>
            </div>
        </div>
      </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script src="jquery/jquery.min.js"></script>
<script src="js/sb-admin-datatables.min.js"></script>
<script src="chart.js/Chart.min.js"></script>
<script>
function getChart(sel) {
    
    if(id == 0){
        document.getElementById('chart').innerHTML = "No selected device";
        document.getElementById('chartTitle').innerHTML = "TITLE";
    } else {
        var id = document.getElementById('select').value;
        var dev = sel.options[sel.selectedIndex].innerHTML; 
        document.getElementById('chart').innerHTML = '<canvas id="myCanvas" class="canvas" width="1280" height="650">Sorry, your browser does not support the &lt;canvas&gt; element.</canvas>';
        document.getElementById('chartTitle').innerHTML = dev;
        var ctx = document.getElementById('myCanvas').getContext('2d');
        var myChart = new Chart (ctx, {
            type: 'line',
            datasets: [{
					label: 'My First dataset',
					backgroundColor: 'red',
					borderColor: 'red',
					data: [
						Math.random * 10,
						Math.random * 10,
						Math.random * 10,
						Math.random * 10
						
					],
					fill: false,
				}],
            options: {
				responsive: true,
				title: {
					display: true,
					text: 'Chart.js Line Chart'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Month'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Value'
						}
					}]
				}
			}
        })
        myChart.update();
    }
}

    {# function getChart(sel) {
        var id = document.getElementById('select').value;
        var dev = sel.options[sel.selectedIndex].innerHTML;
        if(id == 0){
            document.getElementById('chart').innerHTML = "No selected device";
            document.getElementById('chartTitle').innerHTML = "TITLE";
        } else {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function(){
                if(this.readyState == 4 && this.status == 200){
                    document.getElementById('chart').innerHTML = this.responseText;
                    document.getElementById('chartTitle').innerHTML = dev;
                    drawCanvas();
                }
            };
            xhttp.open("POST", "chart.php", true);
            xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhttp.send("idDevice=" + id);
        }
    };
    function drawCanvas() {
        var ctx = document.getElementById("myChart").getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
                datasets: [{
                    label: '# of Votes',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
        });;
    } #}
</script>

{% endblock %}